<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Saved Stories</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<!-- Vue -->
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

<style>
body{
    background:#f4f6f5;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
}

/* Header */
.app-header{
    background:#fff;
    position:sticky;
    top:0;
    z-index:10;
    border-bottom:1px solid #e5e5e5;
}

/* Filter Pills */
.filter-scroll{
    overflow-x:auto;
    white-space:nowrap;
}
.filter-btn{
    border-radius:20px;
    padding:6px 16px;
    font-size:14px;
    margin-right:8px;
}
.filter-btn.active{
    background:#3ba17c;
    color:#fff;
}

/* Card */
.story-card{
    background:#fff;
    border-radius:14px;
}
.story-image{
    width:72px;
    height:72px;
    object-fit:cover;
    border-radius:10px;
}

/* Bottom Sheet */
.sheet{
    position:fixed;
    left:0;
    right:0;
    bottom:0;
    background:#fff;
    border-radius:18px 18px 0 0;
    padding:16px;
    box-shadow:0 -10px 30px rgba(0,0,0,.15);
}
</style>
</head>

<body>
<div id="app">

<!-- ðŸ” HEADER -->
<div class="app-header p-3 d-flex align-items-center">
    <i class="bi bi-arrow-left fs-5"></i>
    <h6 class="m-0 mx-auto fw-semibold">Saved Stories</h6>
    <i class="bi bi-bookmark fs-5"></i>
</div>

<!-- ðŸ”˜ FILTER -->
<div class="px-3 pt-3 filter-scroll">
    <button
        class="btn btn-light filter-btn"
        :class="{active: activeTag==='All'}"
        @click="activeTag='All'"
    >All</button>

    <button
        v-for="tag in tags"
        :key="tag"
        class="btn btn-light filter-btn"
        :class="{active: activeTag===tag}"
        @click="activeTag=tag"
    >
        {{ tag }}
    </button>
</div>

<!-- ðŸ“š STORIES -->
<div class="container py-3">

<div v-if="filteredStories.length===0" class="text-center py-5 text-muted">
    <i class="bi bi-bookmark-x display-4"></i>
    <p class="mt-2">No saved stories</p>
</div>

<div
    v-for="story in filteredStories"
    :key="story.id"
    class="mb-3"
>
    <div class="story-card p-2 shadow-sm d-flex align-items-center">
        <img :src="story.image" class="story-image me-3">
        <div class="flex-grow-1">
            <div class="small text-success">{{ story.tag }}</div>
            <div class="fw-semibold">{{ story.title }}</div>
            <small class="text-muted">
                <i class="bi bi-clock"></i> {{ story.readingTime }} min read
            </small>
        </div>
        <i
            class="bi bi-bookmark-dash fs-5 text-danger"
            @click.stop="confirmRemove(story)"
        ></i>
    </div>
</div>
</div>

<!-- ðŸ§¾ CONFIRMATION BOTTOM SHEET -->
<div v-if="showConfirm">
    <div class="sheet">
        <p class="fw-semibold mb-2">Remove from saved?</p>
        <div class="d-flex align-items-center mb-3">
            <img :src="selectedStory.image" class="story-image me-2">
            <div>
                <div class="fw-semibold">{{ selectedStory.title }}</div>
                <small class="text-muted">{{ selectedStory.tag }}</small>
            </div>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-light w-50" @click="showConfirm=false">Cancel</button>
            <button class="btn btn-success w-50" @click="removeStory">Yes, Remove</button>
        </div>
    </div>
</div>

</div>

<script>
const {createApp}=Vue;

createApp({
data(){
    return{
        stories:[],
        activeTag:'All',
        showConfirm:false,
        selectedStory:null
    }
},
computed:{
    tags(){
        return [...new Set(this.stories.map(s=>s.tag))];
    },
    filteredStories(){
        if(this.activeTag==='All') return this.stories;
        return this.stories.filter(s=>s.tag===this.activeTag);
    }
},
mounted(){
    this.loadSavedStories();
},
methods:{
    loadSavedStories(){
        const ids=JSON.parse(localStorage.getItem("savedStories"))||[];
        ids.forEach(id=>{
            fetch(`../stories/${id}.json`)
            .then(r=>r.json())
            .then(d=>{
                const words=d.content.join(" ").split(" ").length;
                this.stories.push({
                    id,
                    title:d.title,
                    tag:d.tag,
                    image:d.image,
                    readingTime:Math.ceil(words/120)
                });
            });
        });
    },
    confirmRemove(story){
        this.selectedStory=story;
        this.showConfirm=true;
    },
    removeStory(){
        const id=this.selectedStory.id;
        this.stories=this.stories.filter(s=>s.id!==id);
        let saved=JSON.parse(localStorage.getItem("savedStories"))||[];
        localStorage.setItem("savedStories",JSON.stringify(saved.filter(i=>i!==id)));
        this.showConfirm=false;
    }
}
}).mount("#app");
</script>

</body>
  </html>
