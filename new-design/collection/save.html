<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Saved Stories</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Bootstrap CSS only (no JS) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body { background-color: #f8f9fa; padding: 20px; }
        .story-card { border: none; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .story-card img { height: 120px; object-fit: cover; }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [stories, setStories] = useState([]);
            const [savedIds, setSavedIds] = useState([]);

            useEffect(() => {
                const ids = JSON.parse(localStorage.getItem("savedStories")) || [];
                setSavedIds(ids);
                
                if (ids.length === 0) return;

                const loadStories = async () => {
                    const loadedStories = [];
                    for (const id of ids) {
                        try {
                            const res = await fetch(`../stories/${id}.json`);
                            const data = await res.json();
                            const words = data.content.join(" ").split(" ").length;
                            data.minutes = Math.ceil(words / 120);
                            loadedStories.push({...data, id});
                        } catch (error) {
                            console.error("Error loading story:", error);
                        }
                    }
                    setStories(loadedStories);
                };
                
                loadStories();
            }, []);

            const removeSave = (id) => {
                const newIds = savedIds.filter(item => item !== id);
                localStorage.setItem("savedStories", JSON.stringify(newIds));
                setSavedIds(newIds);
                setStories(stories.filter(story => story.id !== id));
            };

            if (savedIds.length === 0) {
                return (
                    <div className="text-center text-muted py-5">
                        <h4>No saved stories yet.</h4>
                    </div>
                );
            }

            return (
                <div className="container">
                    <h3 className="mb-4">‚≠ê Saved Stories</h3>
                    <div className="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                        {stories.map(story => (
                            <div className="col" key={story.id}>
                                <div className="story-card bg-white">
                                    <div className="row g-0">
                                        <div className="col-4">
                                            <img src={story.image} className="w-100 h-100" alt={story.title} />
                                        </div>
                                        <div className="col-8 p-3">
                                            <h6 className="fw-bold mb-1">{story.title}</h6>
                                            <p className="text-muted small mb-2">{story.tag}</p>
                                            <div className="d-flex justify-content-between align-items-center">
                                                <span className="text-muted small">{story.minutes} min read</span>
                                                <button 
                                                    className="btn btn-sm btn-outline-danger"
                                                    onClick={() => removeSave(story.id)}
                                                >
                                                    Unsave
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
