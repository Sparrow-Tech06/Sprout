<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport"
content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">

<title>Sprout â€“ Simple Money Story Learning App</title>

<meta name="google" content="notranslate">

<meta http-equiv="Content-Security-Policy"
content="default-src 'self' https: data:;
img-src * data:;
style-src 'self' https: 'unsafe-inline';
script-src 'self' https: 'unsafe-inline';">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<script src="control_center/version-check.js" defer></script>
<script src="control_center/app-version-checker.js" defer></script>

<style>
:root{
  --bg:#ffffff;
  --text:#000000;
  --primary:#5b8dfc;
  --card:#ffffff;
  --icon:#2e7d32;
  --radius:14px;
  --border:1px solid rgba(0,0,0,0.08);
  --skeleton:#e5e7eb;
}

@media(prefers-color-scheme:dark){
  :root{
    --bg:#212529;
    --text:#ffffff;
    --card:#343a40;
    --border:1px solid rgba(255,255,255,0.08);
    --skeleton:#3a3f44;
  }
}

*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  user-select:none;
}

body{
  background:var(--bg);
  font-family:'Inter',system-ui,sans-serif;
  color:var(--text);
}

/* ================= HEADER ================= */
.header-section{
  background:var(--card);
  border-bottom:var(--border);
  padding:6px 8px;
  position:sticky;
  top:0;
  z-index:1030;
  transition:transform .3s ease;
}
.navbar-hidden{transform:translateY(-100%);}

.btn-clean{border:none;background:none;}
.notification-icon{
  background:#e9f5ef;
  border-radius:50%;
  padding:6px 9px;
}
.notification-icon i{color:#2f8f6b;font-size:1.3rem;}

/* ================= STORY CARD ================= */
.story-card{
  background:var(--card);
  border-radius:var(--radius);
  border:var(--border);
  overflow:hidden;
}

/* ---------- Image wrapper ---------- */
.thumb{
  position:relative;
}

.thumb img{
  width:100%;
  aspect-ratio:16/7;
  object-fit:cover;
  display:block;
  opacity:0;
  transition:opacity .4s ease;
}

.thumb img.loaded{
  opacity:1;
}

/* ---------- Image skeleton ---------- */
.img-skeleton{
  position:absolute;
  inset:0;
  background:linear-gradient(
    90deg,
    var(--skeleton) 25%,
    #f3f4f6 37%,
    var(--skeleton) 63%
  );
  background-size:400% 100%;
  animation:skeleton 1.4s ease infinite;
}

/* Hide skeleton after image load */
.img-skeleton.hide{
  opacity:0;
  pointer-events:none;
  transition:opacity .4s ease;
}

@keyframes skeleton{
  0%{background-position:100% 0;}
  100%{background-position:0 0;}
}

/* ---------- Tags ---------- */
.ribbon{
  position:absolute;
  top:12px;
  right:12px;
  background:var(--primary);
  padding:4px 8px;
  border-radius:20px;
  color:#fff;
  font-size:.7rem;
  font-weight:600;
}

.new-tag{
  position:absolute;
  top:12px;
  left:12px;
  background:#ff3b30;
  padding:4px 8px;
  border-radius:6px;
  color:#fff;
  font-size:.75rem;
  font-weight:600;
}

/* ---------- Typography ---------- */
h4{font-size:1rem;}
p{font-size:.8rem;}
small{font-size:.7rem;}
.app-tagline{font-size:.75rem;}

/* ================= PAGE SKELETON ================= */
.page-skeleton{
  background:linear-gradient(
    90deg,
    var(--skeleton) 25%,
    #f3f4f6 37%,
    var(--skeleton) 63%
  );
  background-size:400% 100%;
  animation:skeleton 1.4s ease infinite;
  border-radius:8px;
}

.ps-img{aspect-ratio:16/7;}
.ps-line{height:10px;margin-bottom:8px;}
.ps-lg{width:100%;}
.ps-md{width:80%;}
.ps-sm{width:60%;}

/* ================= COLOR CYCLE ================= */
#story-container>.col-12:nth-child(5n+1) .story-card{background:#ffe3e3;}
#story-container>.col-12:nth-child(5n+2) .story-card{background:#e7f5ff;}
#story-container>.col-12:nth-child(5n+3) .story-card{background:#ebfbee;}
#story-container>.col-12:nth-child(5n+4) .story-card{background:#fff9db;}
#story-container>.col-12:nth-child(5n+5) .story-card{background:#f3f0ff;}
</style>
</head>

<body>

<header id="main-header" class="header-section">
<div class="container-fluid d-flex justify-content-between align-items-center">
<div class="d-flex align-items-center gap-2">
<button class="btn btn-clean" data-bs-toggle="offcanvas" data-bs-target="#sidebar">
<i class="bi bi-list fs-3"></i>
</button>
<div>
<h1 class="m-0 fw-bold fs-6">Sprout</h1>
<span class="app-tagline">Simple stories, lasting thoughts</span>
</div>
</div>
<a href="notifications/notifications.html" class="notification-icon">
<i class="bi bi-bell-fill"></i>
</a>
</div>
</header>

<main class="container mt-4 pb-5">
<section id="story-container" class="row g-3"></section>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
const box = document.getElementById("story-container");

/* ---------- Page Skeleton ---------- */
function renderPageSkeleton(count=5){
  let html="";
  for(let i=0;i<count;i++){
    html+=`
    <div class="col-12">
      <article class="story-card">
        <div class="page-skeleton ps-img"></div>
        <div class="p-3">
          <div class="page-skeleton ps-line ps-lg"></div>
          <div class="page-skeleton ps-line ps-md"></div>
          <div class="page-skeleton ps-line ps-sm"></div>
        </div>
      </article>
    </div>`;
  }
  box.innerHTML=html;
}

renderPageSkeleton();

/* ---------- Load Data ---------- */
fetch("stories.json")
.then(res=>res.json())
.then(data=>{
  let html="";
  data.forEach(story=>{
    html+=`
    <div class="col-12">
      <a href="${story.link}" class="text-decoration-none text-dark">
        <article class="story-card">
          <div class="thumb">
            <div class="img-skeleton"></div>
            <img src="${story.image}" loading="lazy"
              onload="this.classList.add('loaded'); this.previousElementSibling.classList.add('hide');">
            ${story.isNew ? `<div class="new-tag">NEW</div>` : ``}
            <div class="ribbon">${story.tag}</div>
          </div>
          <div class="p-3">
            <h4 class="fw-bold">${story.title}</h4>
            <p class="mb-1">${story.subtitle}</p>
            <small><i class="bi bi-clock"></i> ${story.duration}</small>
          </div>
        </article>
      </a>
    </div>`;
  });
  box.innerHTML=html;
})
.catch(()=>{
  box.innerHTML=`<p class="text-center text-muted">Unable to load stories</p>`;
});

/* ---------- Header Hide ---------- */
let prev=window.pageYOffset;
const header=document.getElementById("main-header");
window.addEventListener("scroll",()=>{
  const curr=window.pageYOffset;
  if(curr>60 && curr>prev){header.classList.add("navbar-hidden");}
  else{header.classList.remove("navbar-hidden");}
  prev=curr;
});
</script>

</body>
</html>
