<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">

<title>Story</title>

<style>
  body {
    font-family: Arial;
    padding: 20px;
    line-height: 1.6;
    transition: font-size 0.2s ease;
  }

  img {
    width: 100%;
    border-radius: 12px;
    margin: 15px 0;
  }

  p { margin-bottom: 15px; }

  /* Progress Bar */
  #progressBar {
    position: fixed;
    top: 0; left: 0;
    height: 4px;
    background: #4fa3f7;
    width: 0%;
    z-index: 999;
  }

  /* Top buttons */
  .tools {
    display: flex;
    gap: 12px;
    margin-bottom: 20px;
  }

  .btn {
    padding: 7px 12px;
    border-radius: 6px;
    border: none;
    background: #e4e4e4;
    font-size: 14px;
  }

  /* üîπ Skeleton Loader */
  .skeleton {
    background: linear-gradient(
      90deg,
      #eee 25%,
      #f5f5f5 37%,
      #eee 63%
    );
    background-size: 400% 100%;
    animation: shimmer 1.4s infinite;
    border-radius: 6px;
    margin-bottom: 15px;
  }

  @keyframes shimmer {
    0% { background-position: 100% 0; }
    100% { background-position: -100% 0; }
  }

  .sk-title { height: 32px; width: 70%; }
  .sk-text { height: 14px; width: 100%; }
  .sk-img { height: 200px; }

  /* Error */
  .error {
    text-align: center;
    margin-top: 50px;
  }

  .error img {
    max-width: 260px;
    opacity: 0.8;
  }
</style>
</head>

<body>

<div id="progressBar"></div>

<!-- üîπ LOADING -->
<div id="loader">
  <div class="skeleton sk-title"></div>
  <div class="skeleton sk-text"></div>
  <div class="skeleton sk-text"></div>
  <div class="skeleton sk-img"></div>
  <div class="skeleton sk-text"></div>
  <div class="skeleton sk-text"></div>
  <div class="skeleton sk-text"></div>
</div>

<!-- üîπ STORY CONTENT -->
<div id="story" style="display:none;">
  <h1 id="title"></h1>
  <p id="tag"></p>
  <p id="time"></p>

  <div class="tools">
    <button id="fontInc" class="btn">A+</button>
    <button id="fontDec" class="btn">A-</button>
    <button id="saveBtn" class="btn">‚≠ê Save</button>
  </div>

  <img id="image">
  <div id="content"></div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const storyId = params.get("id");

let currentFont = 16;

// Fetch Story JSON
fetch(`stories/${storyId}.json`)
  .then(res => {
    if (!res.ok) throw new Error("Not found");
    return res.json();
  })
  .then(data => {
    document.getElementById("loader").style.display = "none";
    document.getElementById("story").style.display = "block";

    document.getElementById("title").innerText = data.title;
    document.getElementById("tag").innerText = data.tag;
    document.getElementById("image").src = data.image;

    const totalWords = data.content.join(" ").split(" ").length;
    const minutes = Math.ceil(totalWords / 120);
    document.getElementById("time").innerText = minutes + " min read";

    let html = "";
    data.content.forEach(c => html += `<p>${c}</p>`);
    document.getElementById("content").innerHTML = html;

    loadSaveStatus();
  })
  .catch(() => {
    document.body.innerHTML = `
      <div class="error">
        <img src="https://picsum.photos/300/200?grayscale">
        <h2>Story not found</h2>
        <p>Please try another story.</p>
      </div>`;
  });

// Progress Bar
window.addEventListener("scroll", () => {
  let docHeight = document.body.scrollHeight - window.innerHeight;
  let scrollPos = window.scrollY;
  document.getElementById("progressBar").style.width =
    (scrollPos / docHeight) * 100 + "%";
});

// Font resize
fontInc.onclick = () => {
  currentFont += 2;
  document.body.style.fontSize = currentFont + "px";
};
fontDec.onclick = () => {
  currentFont -= 2;
  document.body.style.fontSize = currentFont + "px";
};

// Save system
function loadSaveStatus() {
  const saved = JSON.parse(localStorage.getItem("savedStories")) || [];
  const btn = saveBtn;

  if (saved.includes(storyId)) {
    btn.innerText = "‚≠ê Saved";
    btn.style.background = "#ffd24c";
  }

  btn.onclick = toggleSave;
}

function toggleSave() {
  let saved = JSON.parse(localStorage.getItem("savedStories")) || [];

  if (saved.includes(storyId)) {
    saved = saved.filter(id => id !== storyId);
    saveBtn.innerText = "‚≠ê Save";
    saveBtn.style.background = "#e4e4e4";
  } else {
    saved.push(storyId);
    saveBtn.innerText = "‚≠ê Saved";
    saveBtn.style.background = "#ffd24c";
  }

  localStorage.setItem("savedStories", JSON.stringify(saved));
}
</script>

</body>
</html>

