<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">

<title>Story</title>

<!-- Bootstrap Icons -->
<link rel="stylesheet"
href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

<!-- Vue.js CDN -->
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

<style>
body{
  font-family: Arial;
  padding:20px;
  line-height:1.6;
  transition:font-size .2s;
}

img{
  width:100%;
  border-radius:12px;
  margin:15px 0;
}

p{margin-bottom:15px}

/* Progress */
#progressBar{
  position:fixed;
  top:0;left:0;
  height:4px;
  background:#4fa3f7;
  width:0%;
  z-index:999;
}

/* Tools */
.tools{
  display:flex;
  gap:12px;
  margin-bottom:20px;
}

.btn{
  padding:7px 12px;
  border-radius:6px;
  border:none;
  background:#e4e4e4;
  font-size:14px;
}

/* Skeleton */
.skeleton{
  background:linear-gradient(90deg,#eee 25%,#f5f5f5 37%,#eee 63%);
  background-size:400% 100%;
  animation:shimmer 1.4s infinite;
  border-radius:6px;
  margin-bottom:15px;
}
@keyframes shimmer{
  0%{background-position:100% 0}
  100%{background-position:-100% 0}
}
.sk-title{height:32px;width:70%}
.sk-text{height:14px;width:100%}
.sk-img{height:200px}

/* Error */
.error{
  text-align:center;
  margin-top:60px;
}
.error img{max-width:260px; }

.story-tag{
    background:#eef4ff;
    color:#0d6efd;
    font-size:12px;
    padding:4px 10px;
    border-radius:20px;
  }

  .read-time{
    font-size:12px;
    color:#6c757d;
  }
  .action-btn{
    border:none;
    background:#f1f3f5;
    border-radius:50%;
    width:38px;
    height:38px;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  
</style>
</head>

<body>

<div id="app">
  <div id="progressBar"></div>

  <!-- Loader -->
  <div v-if="loading">
    <div class="skeleton sk-title"></div>
    <div class="skeleton sk-text"></div>
    <div class="skeleton sk-img"></div>
    <div class="skeleton sk-text"></div>
    <div class="skeleton sk-text"></div>
  </div>

  <!-- Story -->
  <div v-else-if="story">
    <h1>{{ story.title }}</h1> <!-- Title -->
    
    <!-- Tag & Read Time -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <span class="story-tag"><i class="bi bi-tags"></i> {{ story.tag }} </span>
      <span class="read-time">
        <i class="bi bi-clock"></i> {{ readTime }} min read
      </span>
    </div>
    
    <img :src="story.image">
    
    <div class="tools d-flex justify-content-end gap-2 mb-3">
      <button class="btn" @click="fontInc">
        <i class="bi bi-zoom-in"></i>
      </button>
      <button class="btn" @click="fontDec">
        <i class="bi bi-zoom-out"></i>
      </button>
      <button class="btn" @click="toggleSave"
        :style="{background: saved ? '#ffd24c' : '#e4e4e4'}">
        <i class="bi"
           :class="saved ? 'bi-bookmark-star-fill' : 'bi-bookmark-star'"></i>
      </button>
    </div>

    <p v-for="(p,i) in story.content" :key="i">{{ p }}</p>
  </div>

  <!-- Error -->
  <div v-else class="error">
    <img src="assets/not-found.png">
    <h2>Story not found</h2>
    <p>Please try another story</p>
  </div>
</div>

<script>
const { createApp } = Vue;

createApp({
  data(){
    return{
      story:null,
      loading:true,
      fontSize:16,
      saved:false
    }
  },
  computed:{
    readTime(){
      if(!this.story) return 0;
      const words=this.story.content.join(" ").split(" ").length;
      return Math.ceil(words/120);
    }
  },
  mounted(){
    const id=new URLSearchParams(location.search).get("id");

    fetch(`stories/${id}.json`)
      .then(r=>{ if(!r.ok) throw ""; return r.json(); })
      .then(d=>{
        this.story=d;
        this.loading=false;

        const savedArr=JSON.parse(localStorage.getItem("savedStories"))||[];
        this.saved=savedArr.includes(id);
      })
      .catch(()=>{ this.loading=false; });

    window.addEventListener("scroll",()=>{
      let h=document.body.scrollHeight-innerHeight;
      progressBar.style.width=(scrollY/h)*100+"%";
    });
  },
  methods:{
    fontInc(){
      this.fontSize+=2;
      document.body.style.fontSize=this.fontSize+"px";
    },
    fontDec(){
      this.fontSize-=2;
      document.body.style.fontSize=this.fontSize+"px";
    },
    toggleSave(){
      const id=new URLSearchParams(location.search).get("id");
      let savedArr=JSON.parse(localStorage.getItem("savedStories"))||[];

      if(this.saved){
        savedArr=savedArr.filter(x=>x!==id);
      }else{
        savedArr.push(id);
      }

      this.saved=!this.saved;
      localStorage.setItem("savedStories",JSON.stringify(savedArr));
    }
  }
}).mount("#app");
</script>

</body>
</html>

